<!DOCTYPE html>
<html>
<head>
    <title>AKSOY34 LIVE</title>
    <style>
        body {background:#000;color:#0f0;font-family:monospace;text-align:center;padding:50px;}
        h1 {font-size:3em;text-shadow:0 0 10px #0f0;}
        #s {font-size:1.5em;margin:20px;padding:10px;border:1px solid #0f0;border-radius:5px;}
    </style>
</head>
<body>
    <h1>AKSOY34 LIVE</h1>
    <p id="s">Bağlantı kuruluyor...</p>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script>
        const NGROK_URL = "https://ike-unliteralised-amusingly.ngrok-free.dev";

        const socket = io(NGROK_URL, {
            transports: ['websocket'],  // ZORUNLU: polling yerine websocket
            secure: true                // HTTPS için
        });

        const s = document.getElementById('s');
        let ctx;

        socket.on('connect', () => {
            s.textContent = 'SES GELİYOR!';
            s.style.color = '#0f0';
        });

        socket.on('connect_error', (err) => {
            s.textContent = 'BAĞLANTI HATASI: ' + err.message;
            s.style.color = '#f00';
        });

        socket.on('audio', (data) => {
            if (!ctx) ctx = new AudioContext();
            const array = new Int16Array(data);
            const buffer = ctx.createBuffer(1, array.length, 44100);
            buffer.copyToChannel(array, 0);
            const src = ctx.createBufferSource();
            src.buffer = buffer;
            src.connect(ctx.destination);
            src.start();
        });
    </script>
</body>
</html>
